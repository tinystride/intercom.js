/*! intercom.js | https://github.com/diy/intercom.js | Apache License (v2) */
var Intercom=function(){var g=function(){};g.createInterface=function(a){return{on:function(b,c){"undefined"===typeof this[a]&&(this[a]={});this[a].hasOwnProperty(b)||(this[a][b]=[]);this[a][b].push(c)},off:function(b,c){"undefined"!==typeof this[a]&&this[a].hasOwnProperty(b)&&k.removeItem(c,this[a][b])},trigger:function(b){if("undefined"!==typeof this[a]&&this[a].hasOwnProperty(b))for(var c=Array.prototype.slice.call(arguments,1),e=0;e<this[a][b].length;e++)this[a][b][e].apply(this[a][b][e],c)}}};
var n=g.createInterface("_handlers");g.prototype._on=n.on;g.prototype._off=n.off;g.prototype._trigger=n.trigger;var p=g.createInterface("handlers");g.prototype.on=function(){p.on.apply(this,arguments);Array.prototype.unshift.call(arguments,"on");this._trigger.apply(this,arguments)};g.prototype.off=p.off;g.prototype.trigger=p.trigger;var f=void 0;if(function(){try{return window.localStorage["local-storage-test"]=1,!0}catch(a){return!1}})f=window.localStorage;var k={};k.guid=function(){var a=function(){return(65536*
(1+Math.random())|0).toString(16).substring(1)};return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}();k.throttle=function(a,b){var c=0;return function(){var e=(new Date).getTime();e-c>a&&(c=e,b.apply(this,arguments))}};k.extend=function(a,b){"undefined"!==typeof a&&a||(a={});if("object"===typeof b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};k.removeItem=function(a,b){for(var c=b.length-1;0<=c;c--)b[c]===a&&b.splice(c,1);return b};var d=function(){var a=this,b=
(new Date).getTime();this.origin=k.guid();this.lastMessage=b;this.bindings=[];this.receivedIDs={};this.previousValues={};b=function(){a._onStorageEvent.apply(a,arguments)};window.attachEvent?document.attachEvent("onstorage",b):window.addEventListener("storage",b,!1)};d.prototype._transaction=function(a){var b=this,c=!1,e=!1,q=null,d=function(){if(!c){var g=(new Date).getTime(),t=parseInt(f.getItem(m)||0);t&&1E3>g-t?(e||(b._on("storage",d),e=!0),q=window.setTimeout(d,20)):(c=!0,f.setItem(m,g),a(),
e&&b._off("storage",d),q&&window.clearTimeout(q),f.removeItem(m))}};d()};d.prototype._cleanup_emit=k.throttle(100,function(){this._transaction(function(){for(var a=(new Date).getTime()-u,b=0,c=JSON.parse(f.getItem(h)||"[]"),e=c.length-1;0<=e;e--)c[e].timestamp<a&&(c.splice(e,1),b++);0<b&&f.setItem(h,JSON.stringify(c))})});d.prototype._cleanup_once=k.throttle(100,function(){var a=this;this._transaction(function(){var b,c=JSON.parse(f.getItem(l)||"{}");(new Date).getTime();var e=0;for(b in c)a._once_expired(b,
c)&&(delete c[b],e++);0<e&&f.setItem(l,JSON.stringify(c))})});d.prototype._once_expired=function(a,b){if(!b||!b.hasOwnProperty(a)||"object"!==typeof b[a])return!0;var c=b[a].ttl||v,e=(new Date).getTime();return b[a].timestamp<e-c};d.prototype._localStorageChanged=function(a,b){if(a&&a.key)return a.key===b;var c=f.getItem(b);if(c===this.previousValues[b])return!1;this.previousValues[b]=c;return!0};d.prototype._onStorageEvent=function(a){a=a||window.event;var b=this;this._localStorageChanged(a,h)&&
this._transaction(function(){for(var a=(new Date).getTime(),e=f.getItem(h),e=JSON.parse(e||"[]"),d=0;d<e.length;d++)if(e[d].origin!==b.origin&&!(e[d].timestamp<b.lastMessage)){if(e[d].id){if(b.receivedIDs.hasOwnProperty(e[d].id))continue;b.receivedIDs[e[d].id]=!0}b.trigger(e[d].name,e[d].payload)}b.lastMessage=a});this._trigger("storage",a)};d.prototype._emit=function(a,b,c){if((c="string"===typeof c||"number"===typeof c?String(c):null)&&c.length){if(this.receivedIDs.hasOwnProperty(c))return;this.receivedIDs[c]=
!0}var e={id:c,name:a,origin:this.origin,timestamp:(new Date).getTime(),payload:b},d=this;this._transaction(function(){var c=f.getItem(h)||"[]",g="[]"===c?"":",",c=[c.substring(0,c.length-1),g,JSON.stringify(e),"]"].join("");f.setItem(h,c);d.trigger(a,b);window.setTimeout(function(){d._cleanup_emit()},50)})};d.prototype.bind=function(a,b){for(var c=0;c<d.bindings.length;c++){var e=d.bindings[c].factory(a,b||null,this);e&&this.bindings.push(e)}};d.prototype.emit=function(a,b){this._emit.apply(this,
arguments);this._trigger("emit",a,b)};d.prototype.once=function(a,b,c){if(d.supported){var e=this;this._transaction(function(){var d=JSON.parse(f.getItem(l)||"{}");e._once_expired(a,d)&&(d[a]={},d[a].timestamp=(new Date).getTime(),"number"===typeof c&&(d[a].ttl=1E3*c),f.setItem(l,JSON.stringify(d)),b(),window.setTimeout(function(){e._cleanup_once()},50))})}};k.extend(d.prototype,g.prototype);d.bindings=[];d.supported="undefined"!==typeof f;var h="intercom",l="intercom_once",m="intercom_lock",u=5E4,
v=36E5;d.destroy=function(){f.removeItem(m);f.removeItem(h);f.removeItem(l)};d.getInstance=function(){var a=null;return function(){a||(a=new d);return a}}();var r=function(a,b,c){b=k.extend({id:null,send:!0,receive:!0},b);if(b.receive){var d=[],f=function(f,g){-1===d.indexOf(f)&&(d.push(f),a.on(f,function(a){var d="function"===typeof b.id?b.id(f,a):null,e="function"===typeof b.receive?b.receive(f,a):!0;(e||"boolean"!==typeof e)&&c._emit(f,a,d)}))},g;for(g in c.handlers)for(var h=0;h<c.handlers[g].length;h++)f(g,
c.handlers[g][h]);c._on("on",f)}b.send&&c._on("emit",function(c,d){var e="function"===typeof b.send?b.send(c,d):!0;(e||"boolean"!==typeof e)&&a.emit(c,d)})};r.factory=function(a,b,c){return"undefined"===typeof a.socket?!1:new r(a,b,c)};d.bindings.push(r);return d}();
